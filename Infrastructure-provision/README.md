# Proxmox Kubernetes VM Terraform Setup

This repository contains Terraform configurations to automatically deploy a set of virtual machines in a Proxmox environment for use as Kubernetes nodes. The configuration supports various node types like:

- **Master Nodes**
- **Worker Nodes**
- **Bastion Host**
- **Proxy Nodes**
- **DevOps Utility Node**

## ğŸ“ Project Structure

```text
.
â”œâ”€â”€ main.tf                  # Core Proxmox VM definitions
â”œâ”€â”€ provider.tf              # Proxmox provider configuration
â”œâ”€â”€ variables.tf             # All configurable variables
â”œâ”€â”€ terraform.tfvars.example # Example values file (rename to terraform.tfvars)
â””â”€â”€ README.md                # This documentation
```

---

## ğŸ”§ What It Does

The Terraform code dynamically creates VMs in Proxmox based on the count of each node type. Each VM is assigned:
- A static IP address based on its role
- Cloud-init configuration from a Proxmox template
- Tags, names, and VMIDs based on type
- Networking with static IPs per category (master, worker, etc.)

---

## âš™ï¸ Configuration

### `variables.tf`

Define VM counts, Proxmox credentials, and VM base settings here.

Key variables:
- `master_count`, `worker_count`, `bastion_count`, `proxy_count`, `devops_vm`
- `START_VMID`: Helps avoid VMID collisions
- `ssh_keys`: List of SSH public keys for cloud-init login
- `ciuser`: Cloud-init username

### `terraform.tfvars.example`

Rename to `terraform.tfvars` and edit:
```hcl
pm_api_url          = "https://your.proxmox.ip:8006/api2/json"
pm_api_token_secret = "your-secret"
pm_api_token_id     = "root@pam!vm-deployer"

ssh_keys = [
  "ssh-rsa AAAA...",
  "ssh-rsa AAAA..."
]
```

---

## ğŸ–¥ï¸ VM Structure & IPs

VMs are named and assigned IPs dynamically:

| Node Type    | Example Name          | IP Format             |
|--------------|-----------------------|------------------------|
| Master       | master-node-01        | 192.168.1.80+          |
| Bastion      | bastion-node-01       | 192.168.1.83+          |
| Worker       | worker-node-01        | 192.168.1.84+          |
| Proxy        | proxy-node-01         | 192.168.1.88+          |
| DevOps Node  | devops-node-01        | 192.168.1.90+          |

---

## ğŸš€ How to Use

1. **Install Terraform & Proxmox Provider**
   ```bash
   terraform init
   ```

2. **Customize Variables**
   Copy `terraform.tfvars.example` to `terraform.tfvars` and edit accordingly.
3. **Test the Configuration**
   ```bash
   terraform plan
   ```
4. **Apply the Configuration**
   ```bash
   terraform apply --auto-approve
   ```

---

## ğŸ§© Requirements

- Proxmox VE with API access
- Cloud-init ready VM template (`ubuntu-2404-cloudinit-template`)
- Properly configured Proxmox token with permissions

---

## ğŸ“Œ Notes

- The cloud-init user is defined as `ciuser` (default: `eric`)
- Each VM boots from a cloned template with SSH access
- Logs available in `terraform-plugin-proxmox.log`

---

## ğŸ› ï¸ Customization Tips

- Edit the `.tf` files to adjust VM specs (CPU, RAM, disk)
- Add node types by modifying the logic inside the respective `.tf` files
- Use `terraform destroy` to remove all deployed VMs

---

## ğŸ‘¨â€ğŸ’» Author

Generated by [@Eric mwakazi](https://www.linkedin.com/in/eric-mwakazi)  and [@Emmanuel Kirui](https://www.linkedin.com/in/emmanuel-kirui/) â€“ Automating cloud-native infrastructure in homelabs and production.

---
