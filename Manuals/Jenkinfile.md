#### The Jenkinsfile
* The pipeline is defined using Declarative Pipeline syntax, structured with:
* parameters: allows user to choose between blue/green environments.
* environment: defines reusable variables.

* stages: each step in the CI/CD process.

* post: actions after pipeline runs (like sending an email).

##### 🔧 Parameters Section
```groovy
parameters {
    choice(name: 'DEPLOY_ENV', choices: ['blue', 'green'], ...)
    choice(name: 'DOCKER_TAG', choices: ['blue', 'green'], ...)
    booleanParam(name: 'SWITCH_TRAFFIC', ...)
}
```
* Lets the engineer choose:

    * Blue or Green environment to deploy to
    * Docker image tag to use
    * Whether to switch traffic to the newly deployed version

##### 🌍 Environment Section
```groovy
environment {
    IMAGE_NAME = "mwakazi/bankapp"
    ...
}
```
* Sets shared variables like image name, SonarQube scanner, and recipient email.

##### 📦 Build & Deploy Stages
* Initialize > Git Checkout
Clones the Java project from GitLab using credentials.

* Build Java Project
Compiles the code and builds .jar file using Maven.

* Publish Artifact To Nexus
Publishes built artifacts (like .jar) to Nexus repository.

##### 🧪 Code Quality & Security
SonarQube Analysis + Quality Gate
* Analyzes the code using SonarQube

* Ensures it meets quality standards before continuing

##### 🐳 Docker Build & Push
* Builds the Docker image tagged with selected environment (blue/green)

* Pushes it to Docker Hub using stored credentials

* Sends email on success

##### ☸️ Kubernetes Deployment
1. Ensure Namespace Exists
    * Checks if the webapps namespace exists, and creates it if not.

2. Deploy Database
    * Applies the mysql-ds.yml to deploy the MySQL database.

3. Deploy App
    * Remember to edit docker image with your docker registry location in both blue-app-deployment.yml and green-app-deployment.yml
    * Dynamically picks the right YAML file (blue or green) based on user input.

    * Uses app-deployment-blue.yml or app-deployment-green.yml.

4. Deploy Service
    * Applies bankapp-service.yml to expose the app via a Kubernetes service.

5. 🔁 Manage Traffic (Blue-Green Logic) <br>
If SWITCH_TRAFFIC is true:

    * Deletes the old service (if exists)

    * Exposes the new deployment (blue or green) by creating a new service pointing to the new version

6. ✅ Verification
    * Runs kubectl get pods and kubectl get svc to verify deployment health.

    * Sends email confirmation.

7. 📬 Post Steps
    * Always sends email about pipeline result

    * Displays success or failure message

8. 📦 Helper Functions <br>
Defined at the bottom, these make it cleaner to:

    1. deployToKubernetes(file): apply a K8s manifest

    2.  ensureNamespace(): check and create namespace

    3. recreateService(newEnv): switch traffic to the new deployment

    4. verifyDeployment(env): check service/pod status

## 👨‍💻 Author

Generated by [@Eric mwakazi](https://www.linkedin.com/in/eric-mwakazi)  – Automating cloud-native infrastructure in homelabs and production.